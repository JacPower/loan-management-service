


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > LoanEventsProcessor</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.interview.lender.services</a>
</div>

<h1>Coverage Summary for Class: LoanEventsProcessor (com.interview.lender.services)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LoanEventsProcessor</td>
<td class="coverageStat">
  <span class="percent">
    5.9%
  </span>
  <span class="absValue">
    (1/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0.7%
  </span>
  <span class="absValue">
    (1/147)
  </span>
</td>
</tr>
  <tr>
    <td class="name">LoanEventsProcessor$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$0MTDbdLe</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$254mwfTc</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$3zmhA4GJ</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$i9f6KThv</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$jh3aXx9T</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$M3w0RFIx</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$MlYSHHDj</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$oNaE0MTc</td>
  </tr>
  <tr>
    <td class="name">LoanEventsProcessor$MockitoMock$mKXQvsnX$auxiliary$urUbELsA</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    5.6%
  </span>
  <span class="absValue">
    (1/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0.7%
  </span>
  <span class="absValue">
    (1/148)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.interview.lender.services;
&nbsp;
&nbsp;import com.interview.lender.dto.LoanJobDto;
&nbsp;import com.interview.lender.dto.PaymentDto;
&nbsp;import com.interview.lender.dto.ResponseDto;
&nbsp;import com.interview.lender.entity.*;
&nbsp;import com.interview.lender.enums.InstallmentStatus;
&nbsp;import com.interview.lender.enums.LoanEventType;
&nbsp;import com.interview.lender.enums.LoanStatus;
&nbsp;import com.interview.lender.repository.LoanFeeRepository;
&nbsp;import com.interview.lender.repository.LoanRepository;
&nbsp;import com.interview.lender.repository.ProductFeeRepository;
&nbsp;import com.interview.lender.util.Util;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;import org.springframework.transaction.annotation.Transactional;
&nbsp;
&nbsp;import java.time.LocalDate;
&nbsp;import java.time.temporal.ChronoUnit;
&nbsp;import java.util.List;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static com.interview.lender.enums.FeeType.LATE_PAYMENT;
&nbsp;import static org.springframework.http.HttpStatus.OK;
&nbsp;
&nbsp;@Service
<b class="fc">&nbsp;@Slf4j</b>
&nbsp;@RequiredArgsConstructor
&nbsp;public class LoanEventsProcessor {
&nbsp;    private final LoanRepository loanRepository;
&nbsp;    private final NotificationHandler notificationHandler;
&nbsp;    private final RepaymentHandler repaymentHandler;
&nbsp;    private final LoanFeeRepository loanFeeRepository;
&nbsp;    private final ProductFeeRepository productFeeRepository;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public ResponseDto processLoanPayment(PaymentDto requestDto) {
<b class="nc">&nbsp;        return repaymentHandler.processPayment(requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    public ResponseDto applyLateFees(LoanJobDto requestDto) {
<b class="nc">&nbsp;        log.info(&quot;&lt;===Start late fee application job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        LocalDate executionDate = requestDto.getExecutionDate();</b>
<b class="nc">&nbsp;        List&lt;Loan&gt; overdueLoans = loanRepository.findByLoanStatusAndDueDateBefore(LoanStatus.OVERDUE, executionDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (overdueLoans.isEmpty()) {</b>
<b class="nc">&nbsp;            log.info(&quot;No overdue loans found for late fee application&quot;);</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        List&lt;Loan&gt; loansEligibleForLateFee = overdueLoans.stream()</b>
<b class="nc">&nbsp;                .filter(loan -&gt; {</b>
<b class="nc">&nbsp;                    Product product = loan.getProduct();</b>
<b class="nc">&nbsp;                    long daysLate = ChronoUnit.DAYS.between(loan.getDueDate(), executionDate);</b>
<b class="nc">&nbsp;                    return daysLate &gt;= product.getDaysAfterDueForLateFee();</b>
&nbsp;                })
<b class="nc">&nbsp;                .toList();</b>
&nbsp;
<b class="nc">&nbsp;        if (loansEligibleForLateFee.isEmpty()) {</b>
<b class="nc">&nbsp;            log.info(&quot;No loans past the grace period for late fee application&quot;);</b>
<b class="nc">&nbsp;            return Util.buildResponse(&quot;No loans eligible for late fee application&quot;, OK, requestDto);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Found {} overdue loans past grace period out of {} total overdue loans&quot;, loansEligibleForLateFee.size(), overdueLoans.size());</b>
&nbsp;
<b class="nc">&nbsp;        long updatedCount = loansEligibleForLateFee.stream()</b>
<b class="nc">&nbsp;                .filter(loan -&gt; processLateFeeForLoan(loan, executionDate))</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Applied fees to {}/{} eligible loan&quot;, updatedCount, loansEligibleForLateFee.size());</b>
<b class="nc">&nbsp;        log.info(&quot;&lt;===End late fee application job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return Util.buildResponse(&quot;Completed applying late fee&quot;, OK, requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    public ResponseDto sendLoanDueReminders(LoanJobDto requestDto) {
<b class="nc">&nbsp;        log.info(&quot;&lt;===Start sending payment reminders job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        LocalDate executionDate = requestDto.getExecutionDate();</b>
<b class="nc">&nbsp;        int reminderDays = requestDto.getReminderDays();</b>
<b class="nc">&nbsp;        LocalDate thresholdDate = executionDate.plusDays(reminderDays);</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Loan&gt; upcomingLoans = loanRepository.findByLoanStatusAndDueDateBetween(LoanStatus.OPEN, executionDate, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (upcomingLoans.isEmpty()) {</b>
<b class="nc">&nbsp;            String message = &quot;No loans due in the next %d days&quot;.formatted(reminderDays);</b>
<b class="nc">&nbsp;            log.info(message);</b>
<b class="nc">&nbsp;            return Util.buildResponse(message, OK, requestDto);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Found {} upcoming loans due between {} and {}&quot;, upcomingLoans.size(), executionDate, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        long remindersSent = upcomingLoans.stream()</b>
<b class="nc">&nbsp;                .filter(notificationHandler::sendUpcomingPaymentReminder)</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Sent {}/{} payment reminders&quot;, remindersSent, upcomingLoans.size());</b>
<b class="nc">&nbsp;        log.info(&quot;&lt;===End sending payment reminders job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return Util.buildResponse(&quot;Completed sending loan due reminders&quot;, OK, requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    public ResponseDto sendInstallmentDueReminders(LoanJobDto requestDto) {
<b class="nc">&nbsp;        log.info(&quot;&lt;=== Start loan installment due reminder job ===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        LocalDate executionDate = requestDto.getExecutionDate();</b>
<b class="nc">&nbsp;        LocalDate thresholdDate = executionDate.plusDays(requestDto.getReminderDays());</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Installment&gt; upcomingInstallments = getUpcomingInstallments(executionDate, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (upcomingInstallments.isEmpty()) {</b>
<b class="nc">&nbsp;            String message = &quot;No loan installments due in the next %d days&quot;.formatted(requestDto.getReminderDays());</b>
<b class="nc">&nbsp;            log.info(message);</b>
<b class="nc">&nbsp;            return Util.buildResponse(message, OK, requestDto);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Found {} installments due between {} and {}&quot;, upcomingInstallments.size(), executionDate, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        long remindersSent = upcomingInstallments.stream()</b>
<b class="nc">&nbsp;                .filter(notificationHandler::sendInstallmentReminder)</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Sent {}/{} installment reminders&quot;, remindersSent, upcomingInstallments.size());</b>
<b class="nc">&nbsp;        log.info(&quot;&lt;=== End loan installment due reminder job ===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return Util.buildResponse(&quot;Completed sending installment due reminders&quot;, OK, requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    public ResponseDto markLoansAsOverdue(LoanJobDto requestDto) {
<b class="nc">&nbsp;        log.info(&quot;&lt;===Start marking loans as overdue job===&gt;&quot;);</b>
<b class="nc">&nbsp;        int overdueThreshold = requestDto.getOverdueThreshold();</b>
<b class="nc">&nbsp;        LocalDate thresholdDate = requestDto.getExecutionDate().minusDays(overdueThreshold);</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Loan&gt; pastDueLoans = loanRepository.findByLoanStatusAndDueDateBefore(LoanStatus.OPEN, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (pastDueLoans.isEmpty()) {</b>
<b class="nc">&nbsp;            log.info(&quot;No loans past due by {}+ days to mark as overdue&quot;, overdueThreshold);</b>
<b class="nc">&nbsp;            return Util.buildResponse(&quot;No due loans found&quot;, OK, requestDto);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Found {} loans past due by {}+ days&quot;, pastDueLoans.size(), overdueThreshold);</b>
&nbsp;
<b class="nc">&nbsp;        long updatedCount = pastDueLoans.stream()</b>
<b class="nc">&nbsp;                .filter(loan -&gt; updateLoanStatus(loan, LoanStatus.OVERDUE, &quot;System identified loan as overdue&quot;))</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Marked {} of {} loans as OVERDUE&quot;, updatedCount, pastDueLoans.size());</b>
<b class="nc">&nbsp;        log.info(&quot;&lt;===End marking loans as overdue job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return Util.buildResponse(&quot;Completed marking loans as overdue&quot;, OK, requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public ResponseDto markLoansAsDefaulted(LoanJobDto requestDto) {
<b class="nc">&nbsp;        log.info(&quot;&lt;===Start updating overdue loan statuses to defaulted job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        int thresholdDays = requestDto.getDefaultThresholdDays();</b>
<b class="nc">&nbsp;        LocalDate thresholdDate = requestDto.getExecutionDate().minusDays(thresholdDays);</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Loan&gt; severelyOverdueLoans = loanRepository.findByLoanStatusAndDueDateBefore(LoanStatus.OVERDUE, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (severelyOverdueLoans.isEmpty()) {</b>
<b class="nc">&nbsp;            log.info(&quot;No loans overdue by {}+ days to mark as defaulted&quot;, thresholdDays);</b>
<b class="nc">&nbsp;            return Util.buildResponse(&quot;No loans qualify for default status&quot;, OK, requestDto);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Found {} loans overdue by {}+ days&quot;, severelyOverdueLoans.size(), thresholdDays);</b>
&nbsp;
<b class="nc">&nbsp;        long updatedCount = severelyOverdueLoans.stream()</b>
<b class="nc">&nbsp;                .filter(loan -&gt; updateLoanStatus(loan, LoanStatus.DEFAULTED, &quot;System identified loan as defaulted&quot;))</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Marked {} of {} loans as DEFAULTED&quot;, updatedCount, severelyOverdueLoans.size());</b>
<b class="nc">&nbsp;        log.info(&quot;&lt;===End updating overdue loan statuses to defaulted job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return Util.buildResponse(&quot;Completed marking loans as defaulted&quot;, OK, requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Transactional
&nbsp;    public ResponseDto markLoansAsWrittenOff(LoanJobDto requestDto) {
<b class="nc">&nbsp;        log.info(&quot;&lt;===Start identifying write-off loans job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        int writeOffThresholdDays = requestDto.getWriteOffThresholdDays();</b>
<b class="nc">&nbsp;        LocalDate thresholdDate = requestDto.getExecutionDate().minusDays(writeOffThresholdDays);</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Loan&gt; longDefaultedLoans = loanRepository.findByLoanStatusAndDueDateBefore(LoanStatus.DEFAULTED, thresholdDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (longDefaultedLoans.isEmpty()) {</b>
<b class="nc">&nbsp;            log.info(&quot;No loans defaulted for {}+ days to write off&quot;, writeOffThresholdDays);</b>
<b class="nc">&nbsp;            return Util.buildResponse(&quot;No loans that qualify for write-off&quot;, OK, requestDto);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Found {} loans defaulted for {}+ days&quot;, longDefaultedLoans.size(), writeOffThresholdDays);</b>
&nbsp;
<b class="nc">&nbsp;        long updatedCount = longDefaultedLoans.stream()</b>
<b class="nc">&nbsp;                .filter(loan -&gt; updateLoanStatus(loan, LoanStatus.WRITTEN_OFF, &quot;System identified loan as written off&quot;))</b>
<b class="nc">&nbsp;                .count();</b>
&nbsp;
<b class="nc">&nbsp;        log.info(&quot;Marked {} of {} loans as WRITTEN_OFF&quot;, updatedCount, longDefaultedLoans.size());</b>
<b class="nc">&nbsp;        log.info(&quot;&lt;===End identifying write-off candidates job===&gt;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return Util.buildResponse(&quot;Completed marking loans as written-off&quot;, OK, requestDto);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private boolean updateLoanStatus(Loan loan, LoanStatus newStatus, String description) {
<b class="nc">&nbsp;        LoanStatus oldStatus = loan.getLoanStatus();</b>
<b class="nc">&nbsp;        loan.setDescription(description);</b>
<b class="nc">&nbsp;        loan.setLoanStatus(newStatus);</b>
<b class="nc">&nbsp;        loanRepository.save(loan);</b>
&nbsp;
<b class="nc">&nbsp;        boolean notified = notificationHandler.notifyLoanStatusChange(loan, oldStatus, newStatus);</b>
<b class="nc">&nbsp;        if (!notified) {</b>
<b class="nc">&nbsp;            log.warn(&quot;Failed to send notification for loan {} status change to {}&quot;, loan.getId(), newStatus);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private boolean processLateFeeForLoan(Loan loan, LocalDate executionDate) {
<b class="nc">&nbsp;        LocalDate dueDate = loan.getDueDate();</b>
<b class="nc">&nbsp;        if (!executionDate.isAfter(dueDate)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Product product = loan.getProduct();</b>
<b class="nc">&nbsp;        long daysLate = ChronoUnit.DAYS.between(dueDate, executionDate);</b>
&nbsp;
<b class="nc">&nbsp;        if (daysLate &lt; product.getDaysAfterDueForLateFee()) {</b>
<b class="nc">&nbsp;            log.info(&quot;Loan {} is {} days late (grace period: {} days) - fee not applied&quot;, loan.getId(), daysLate, product.getDaysAfterDueForLateFee());</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        List&lt;ProductFee&gt; productFees = productFeeRepository.findByProductId(product.getId());</b>
&nbsp;
<b class="nc">&nbsp;        if (productFees.isEmpty()) {</b>
<b class="nc">&nbsp;            log.info(&quot;No fees configured for product {} of loan {}&quot;, product.getId(), loan.getId());</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        List&lt;Fee&gt; feesToApply = productFees.stream()</b>
<b class="nc">&nbsp;                .map(ProductFee::getFee)</b>
<b class="nc">&nbsp;                .filter(this::isActiveLatePaymentFee)</b>
<b class="nc">&nbsp;                .toList();</b>
<b class="nc">&nbsp;        feesToApply.forEach(fee -&gt; applyFeeToLoan(loan, fee, executionDate));</b>
&nbsp;
<b class="nc">&nbsp;        return !feesToApply.isEmpty();</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private void applyFeeToLoan(Loan loan, Fee fee, LocalDate executionDate) {
<b class="nc">&nbsp;        double feeAmount = calculateFeeAmount(loan, fee);</b>
&nbsp;
<b class="nc">&nbsp;        LoanFee loanFee = LoanFee.builder()</b>
<b class="nc">&nbsp;                .loan(loan)</b>
<b class="nc">&nbsp;                .fee(fee)</b>
<b class="nc">&nbsp;                .amount(feeAmount)</b>
<b class="nc">&nbsp;                .appliedAt(executionDate.atStartOfDay())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;
<b class="nc">&nbsp;        loanFeeRepository.save(loanFee);</b>
&nbsp;
<b class="nc">&nbsp;        loan.setLateFeeApplied(feeAmount);</b>
<b class="nc">&nbsp;        loan.setCurrentBalance(loan.getCurrentBalance() + feeAmount);</b>
<b class="nc">&nbsp;        loanRepository.save(loan);</b>
&nbsp;
<b class="nc">&nbsp;        notificationHandler.sendLoanEventNotification(loan, LoanEventType.FEE_APPLIED);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private List&lt;Installment&gt; getUpcomingInstallments(LocalDate startDate, LocalDate endDate) {
<b class="nc">&nbsp;        return loanRepository.findByLoanStatus(LoanStatus.OPEN).stream()</b>
<b class="nc">&nbsp;                .flatMap(loan -&gt; loan.getInstallments().stream()</b>
<b class="nc">&nbsp;                        .filter(installment -&gt;</b>
<b class="nc">&nbsp;                                installment.getInstallmentStatus() == InstallmentStatus.UNPAID &amp;&amp;</b>
<b class="nc">&nbsp;                                !installment.getDueDate().isBefore(startDate) &amp;&amp;</b>
<b class="nc">&nbsp;                                !installment.getDueDate().isAfter(endDate)))</b>
<b class="nc">&nbsp;                .collect(Collectors.toList());</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private boolean isActiveLatePaymentFee(Fee fee) {
<b class="nc">&nbsp;        return Boolean.TRUE.equals(fee.getIsActive()) &amp;&amp; LATE_PAYMENT.name().equals(fee.getFeeType().name());</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private double calculateFeeAmount(Loan loan, Fee fee) {
<b class="nc">&nbsp;        return switch (fee.getCalculationType()) {</b>
<b class="nc">&nbsp;            case FIXED -&gt; fee.getFeeValue();</b>
<b class="nc">&nbsp;            case PERCENTAGE -&gt; loan.getPrincipalAmount() * fee.getFeeValue();</b>
&nbsp;        };
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-05-02 11:32</div>
</div>
</body>
</html>
